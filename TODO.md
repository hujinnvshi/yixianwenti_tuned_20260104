# 一线问题跟踪数据处理系统 - 开发任务清单

## 阶段一：项目初始化和环境搭建

### 1.1 项目结构创建
- [ ] 创建项目目录结构
- [ ] 创建虚拟环境
- [ ] 初始化git仓库
- [ ] 创建README.md文档

### 1.2 依赖安装
- [ ] 创建requirements.txt文件
- [ ] 安装pandas、openpyxl、xlsxwriter
- [ ] 安装pytest测试框架
- [ ] 安装日志配置库(loguru)

### 1.3 配置文件
- [ ] 创建config.yaml配置文件
- [ ] 配置输入输出文件路径
- [ ] 配置日志级别
- [ ] 创建.env文件(如需要)

---

## 阶段二：数据加载模块

### 2.1 数据读取功能
- [ ] 实现读取表格1(data/计算.xlsx)功能
- [ ] 实现读取表格2(data/原始.xlsx)功能
- [ ] 验证数据行列数(791行×44列)
- [ ] 处理日期列格式转换

### 2.2 数据质量检查
- [ ] 检查关键列是否存在
- [ ] 统计空值数量
- [ ] 检查数据类型
- [ ] 生成数据质量报告

### 2.3 单元测试
- [ ] 编写数据加载测试用例
- [ ] 测试异常处理(文件不存在)
- [ ] 测试日期格式转换
- [ ] 验证数据完整性

---

## 阶段三：数据清洗模块

### 3.1 数据筛选标记
- [ ] 实现`是否剔除`列的标记逻辑
  - [ ] 检查"审批结果" = "审批未通过"
  - [ ] 检查"审批状态" = "终止"
  - [ ] 检查"非研发处理问题类别"包含"需求"
- [ ] 标记符合条件的行

### 3.2 数据验证
- [ ] 统计标记为YES的行数
- [ ] 统计标记为NO的行数
- [ ] 抽样验证标记结果
- [ ] 生成筛选报告

### 3.3 单元测试
- [ ] 测试单一条件筛选
- [ ] 测试多条件组合筛选
- [ ] 测试边界条件
- [ ] 测试空值处理

---

## 阶段四：计算模块 - AE列(研发交付日期偏差)

### 4.1 日期计算逻辑实现
- [ ] 实现基准日期判断逻辑(计划完成时间 vs 期望解决时间)
- [ ] 实现处理方式判断逻辑(研发处理 vs 非研发处理)
- [ ] 实现实际完成日期计算
  - [ ] 优先使用"研发解决时间"
  - [ ] 其次使用"更新时间"(当审批状态=已结束)
  - [ ] 最后使用"当前时间"
- [ ] 计算天数偏差并取整

### 4.2 日期处理工具函数
- [ ] 创建日期格式化工具
- [ ] 创建日期差计算工具
- [ ] 处理空值日期
- [ ] 处理异常日期格式

### 4.3 单元测试
- [ ] 测试研发处理的日期计算
- [ ] 测试非研发处理的返回值
- [ ] 测试空值日期处理
- [ ] 测试日期差计算准确性
- [ ] 对比Excel公式计算结果

---

## 阶段五：计算模块 - AO列(用于交付日期偏差统计)

### 5.1 状态判断逻辑实现
- [ ] 实现AE列是否为数字的判断
- [ ] 实现已解决状态判断(研发解决时间不为空)
- [ ] 实现未解决状态判断(审批状态=已结束)
- [ ] 实现处理中状态判断
- [ ] 计算超时状态(天数偏差>0)

### 5.2 状态值映射
- [ ] 映射到"及时解决"
- [ ] 映射到"未及时解决"
- [ ] 映射到"超时未解决"
- [ ] 映射到"处理中暂未超时"
- [ ] 保留"非研发处理"

### 5.3 单元测试
- [ ] 测试及时解决场景
- [ ] 测试未及时解决场景
- [ ] 测试超时未解决场景
- [ ] 测试处理中暂未超时场景
- [ ] 测试非研发处理保留
- [ ] 验证所有状态值

---

## 阶段六：数据副本列创建

### 6.1 副本列实现
- [ ] 复制AO列到新列
- [ ] 命名为"用于交付日期偏差统计DATA"
- [ ] 验证数据一致性
- [ ] 验证数据类型

### 6.2 单元测试
- [ ] 测试数据完整性复制
- [ ] 验证两列数据完全一致
- [ ] 测试空值处理
- [ ] 测试特殊字符处理

---

## 阶段七：透视表生成模块

### 7.1 数据筛选
- [ ] 筛选"是否剔除" = "NO"
- [ ] 筛选"处理方式" in ["研发处理", "非研发处理"]
- [ ] 验证筛选后的数据量

### 7.2 透视表创建
- [ ] 创建pivot_table
  - [ ] 行: "所涉产品"
  - [ ] 列: "用于交付日期偏差统计"
  - [ ] 值: count("数据id")
- [ ] 处理空值(fillna=0)
- [ ] 验证透视表结构

### 7.3 计算字段实现
- [ ] 计算"解决率"字段
  - [ ] 实现公式: (及时解决 + 未及时解决) / (总计 - 非研发 - 其他排除)
  - [ ] 格式化为百分比(保留两位小数)
  - [ ] 处理除零错误
- [ ] 计算"及时解决率"字段
  - [ ] 实现公式: 及时解决 / (总计 - 非研发 - 其他排除)
  - [ ] 格式化为百分比(保留两位小数)
  - [ ] 处理除零错误

### 7.4 排序
- [ ] 按"及时解决率"从低到高排序
- [ ] 验证排序结果

### 7.5 单元测试
- [ ] 测试透视表数据准确性
- [ ] 测试解决率计算公式
- [ ] 测试及时解决率计算公式
- [ ] 测试百分比格式化
- [ ] 测试排序逻辑

---

## 阶段八：报表生成模块

### 8.1 Excel文件生成
- [ ] 创建ExcelWriter对象
- [ ] 写入Sheet1: "2025122911704000480"(表格2原始数据)
- [ ] 写入Sheet2: "计算解决率过程数据（调整后）"(表格1处理后数据)
- [ ] 写入Sheet3: "计算解决率"(透视表结果)

### 8.2 格式化
- [ ] 设置百分比格式(保留两位小数)
- [ ] 设置日期格式
- [ ] 设置列宽
- [ ] 添加表头样式
- [ ] 冻结首行

### 8.3 文件输出
- [ ] 保存到"第52周一线问题跟踪确认-20260104.xlsx"
- [ ] 验证文件生成成功
- [ ] 验证文件大小合理

### 8.4 单元测试
- [ ] 测试文件生成
- [ ] 验证Sheet数量
- [ ] 验证数据行数
- [ ] 验证格式化效果

---

## 阶段九：主程序集成

### 9.1 流程编排
- [ ] 创建main.py入口文件
- [ ] 集成数据加载模块
- [ ] 集成数据清洗模块
- [ ] 集成计算模块(AE列、AO列)
- [ ] 集成数据副本创建
- [ ] 集成透视表生成
- [ ] 集成报表生成

### 9.2 日志记录
- [ ] 配置日志系统
- [ ] 记录每个处理步骤
- [ ] 记录处理时间
- [ ] 记录错误信息
- [ ] 记录数据统计信息

### 9.3 错误处理
- [ ] 添加异常捕获
- [ ] 实现优雅退出
- [ ] 生成错误报告
- [ ] 发送告警通知(可选)

---

## 阶段十：集成测试

### 10.1 端到端测试
- [ ] 完整流程测试
- [ ] 验证输出文件
- [ ] 对比Excel手工计算结果
- [ ] 性能测试(处理时间)

### 10.2 数据准确性验证
- [ ] 抽样验证AE列计算结果
- [ ] 抽样验证AO列计算结果
- [ ] 验证透视表汇总数据
- [ ] 验证百分比计算
- [ ] 生成验证报告

### 10.3 边界测试
- [ ] 空数据集测试
- [ ] 单行数据测试
- [ ] 异常日期测试
- [ ] 特殊字符测试
- [ ] 大数据量测试

---

## 阶段十一：文档和部署

### 11.1 文档编写
- [ ] 编写API文档
- [ ] 编写使用说明
- [ ] 编写部署文档
- [ ] 编写故障排查指南

### 11.2 代码优化
- [ ] 代码审查
- [ ] 性能优化
- [ ] 代码重构
- [ ] 添加注释

### 11.3 部署准备
- [ ] 创建requirements.txt
- [ ] 创建启动脚本
- [ ] 创建定时任务配置
- [ ] 准备生产环境

---

## 阶段十二：AI辅助验证(可选)

### 12.1 AI验证集成
- [ ] 集成OpenAI API
- [ ] 实现计算逻辑验证
- [ ] 实现数据异常检测
- [ ] 生成AI分析报告

### 12.2 智能建议
- [ ] 实现数据质量评分
- [ ] 生成优化建议
- [ ] 异常数据预警

---

## 优先级说明

### P0 - 必须完成(核心功能)
- 阶段一至九: 所有核心开发和测试任务

### P1 - 重要完成(质量保障)
- 阶段十: 集成测试和验证

### P2 - 建议完成(工程化)
- 阶段十一: 文档和部署

### P3 - 可选功能(增强)
- 阶段十二: AI辅助验证

---

## 当前进度

- [ ] 阶段一: 项目初始化 (0/8)
- [ ] 阶段二: 数据加载模块 (0/9)
- [ ] 阶段三: 数据清洗模块 (0/9)
- [ ] 阶段四: 计算模块-AE列 (0/9)
- [ ] 阶段五: 计算模块-AO列 (0/9)
- [ ] 阶段六: 数据副本列 (0/6)
- [ ] 阶段七: 透视表生成 (0/9)
- [ ] 阶段八: 报表生成 (0/9)
- [ ] 阶段九: 主程序集成 (0/9)
- [ ] 阶段十: 集成测试 (0/9)
- [ ] 阶段十一: 文档和部署 (0/9)
- [ ] 阶段十二: AI辅助验证 (0/6)

**总进度**: 0/110 任务完成

---

## 使用说明

1. 按阶段顺序完成每个任务
2. 每完成一个子任务,勾选对应的checkbox
3. 每完成一个阶段,更新总进度
4. 遇到问题及时记录到问题日志
5. 保持单元测试覆盖率 > 80%
