# 一线问题跟踪数据处理需求文档

## 一、数据源文件

| 表格 | 文件路径 | Sheet名称 | 说明 |
|------|---------|-----------|------|
| 表格1 | [data/计算.xlsx](data/计算.xlsx) | Result 1 | 一线问题数据（含计算字段） |
| 表格2 | [data/原始.xlsx](data/原始.xlsx) | Result 1 | 一线问题原始数据 |

**数据规模**：791行数据

---

## 二、数据处理步骤 1：数据清洗和初步计算

### 2.1 数据筛选标记

对表格1的每条数据，根据以下规则标记 `是否剔除` 列：

| 检查列 | 条件 | 操作 |
|--------|------|------|
| `审批结果` (AK列) | 值 = "审批未通过" | `是否剔除` 列标记为 "YES" |
| `审批状态` (AL列) | 值 = "终止" | `是否剔除` 列标记为 "YES" |
| `非研发处理问题类别` (S列) | 值包含 "需求" | `是否剔除` 列标记为 "YES" |

**说明**：只有同时满足以上所有条件为否的数据才保留（`是否剔除` = "NO"）

### 2.2 计算 AE列：研发交付日期偏差

**列名**：`研发交付日期偏差` (AE列)
**业务含义**：计算实际解决时间与期望解决时间的天数偏差
**计算逻辑**：

```
对于每一行数据：

步骤1：判断基准日期
  如果 "计划完成时间"(W列) 为空：
    基准日期 = "期望解决时间"(O列)
  否则：
    基准日期 = "计划完成时间"(W列)

步骤2：判断处理方式
  如果 "处理方式"(Q列) ≠ "研发处理"：
    返回 "非研发处理"
  否则继续步骤3

步骤3：计算实际完成日期
  如果 "研发解决时间"(AD列) 不为空：
    实际完成日期 = "研发解决时间"(AD列)
  否则（研发解决时间为空）：
    如果 "审批状态"(AL列) = "已结束"：
      实际完成日期 = "更新时间"(AM列)
    否则：
      实际完成日期 = 当前时间

步骤4：计算天数偏差
  天数偏差 = 实际完成日期 - 基准日期
  返回 整数(天数偏差)
```

**对应Excel公式**：
```excel
=IF(W2="",
    IF(Q2="研发处理",
        IF(AD2="",
            IF(AL2="已结束", INT(TEXT(AM2,"YYYY-MM-DD")-O2), INT(TEXT(NOW(),"YYYY-MM-DD")-O2)),
            INT(TEXT(AD2,"YYYY-MM-DD")-O2)
        ),
        "非研发处理"
    ),
    IF(AD2="",
        IF(AL2="已结束", INT(TEXT(AM2,"YYYY-MM-DD")-W2), INT(TEXT(NOW(),"YYYY-MM-DD")-W2)),
        INT(TEXT(AD2,"YYYY-MM-DD")-W2)
    )
)
```

**涉及列的索引**：
- Q列 (17)：`处理方式`
- O列 (15)：`期望解决时间`
- W列 (23)：`计划完成时间`
- AD列 (30)：`研发解决时间`
- AL列 (38)：`审批状态`
- AM列 (39)：`更新时间`

### 2.3 计算 AO列：用于交付日期偏差统计

**列名**：`用于交付日期偏差统计` (AO列)
**业务含义**：根据天数偏差判断问题的解决状态
**计算逻辑**：

```
对于每一行数据：

步骤1：判断AE列是否为数字
  如果 AE列 不是数字：
    返回 AE列 的原值

步骤2：判断是否已解决
  如果 "研发解决时间"(AD列) 不为空（已解决）：
    如果 AE列 > 0：返回 "未及时解决"
    否则：返回 "及时解决"

  否则（研发解决时间为空，未解决）：
    如果 "审批状态"(AL列) = "已结束"：
      如果 AE列 > 0：返回 "未及时解决"
      否则：返回 "及时解决"
    否则（审批未结束）：
      如果 AE列 > 0：返回 "超时未解决"
      否则：返回 "处理中暂未超时"
```

**对应Excel公式**：
```excel
=IF(ISNUMBER(AE2),
    IF(AD2<>"",
        IF(AE2>0, "未及时解决", "及时解决"),
        IF(AL2="已结束",
            IF(AE2>0, "未及时解决", "及时解决"),
            IF(AE2>0, "超时未解决", "处理中暂未超时")
        )
    ),
    AE2
)
```

**可能的取值**：
- `及时解决`：在规定时间内解决
- `未及时解决`：超出规定时间才解决
- `超时未解决`：已经超时且仍在处理中
- `处理中暂未超时`：正在处理且未超时
- `非研发处理`：非研发处理的问题

### 2.4 创建数据副本列

**操作**：将 AO列 `用于交付日期偏差统计` 的值复制到表格最后一列

**新列信息**：
- **列名**：`用于交付日期偏差统计DATA`
- **数据来源**：复制 AO列 的所有值
- **数据类型**：文本（与 AO列 相同）
- **目的**：为其他程序提供纯数据列，便于数据提取和处理

**说明**：此列与 AO列 完全相同，作为数据副本方便外部程序直接读取，避免程序需要理解复杂的列索引关系。

---

## 三、数据处理步骤 2：创建透视表

### 3.1 透视表配置

**透视表名称**：`计算解决率`
**数据源**：表格1（步骤1处理后的数据）

**字段配置**：

| 区域 | 字段名 | 筛选条件 |
|------|--------|----------|
| 筛选器 | `是否剔除` | 选择 "NO" |
| 筛选器 | `处理方式` | 选择 "研发处理" 和 "非研发处理" |
| 行字段 | `所涉产品` | - |
| 列字段 | `用于交付日期偏差统计` (AO列) | - |
| 值字段 | `数据id` | 计数 |

### 3.2 透视表列顺序调整

创建透视表后,需要按照以下顺序排列列:

**列顺序**:
1. `非研发处理` - 非研发处理的问题数量
2. `及时解决` - 在规定时间内解决的问题数量
3. `未及时解决` - 超时才解决的问题数量
4. `处理中暂未超时` - 正在处理且未超时的问题数量
5. `超时未解决` - 已经超时且仍在处理的问题数量
6. `总计` - 该产品的所有问题总数

**说明**: 列顺序必须严格按照上述顺序,确保后续计算公式正确引用。

### 3.3 添加计算字段

在透视表的"总计"列之后添加两个计算字段,格式为百分比,保留两位小数:

#### 3.3.1 解决率

**公式**：
```excel
=IFERROR((及时解决 + 未及时解决) / (总计 - 非研发处理) * 100%, "不涉及研发处理")
```

**说明**：
- `及时解决`：第2列的值
- `未及时解决`：第3列的值
- `总计`：第6列的值
- `非研发处理`：第1列的值
- 计算公式：`(及时解决 + 未及时解决) / (总计 - 非研发处理) * 100%`

**业务含义**：已解决问题的占研发处理问题的比例

#### 3.3.2 及时解决率

**公式**：
```excel
=IFERROR(及时解决 / (总计 - 非研发处理) * 100%, "不涉及研发处理")
```

**说明**：
- `及时解决`：第2列的值
- `总计`：第6列的值
- `非研发处理`：第1列的值
- 计算公式：`及时解决 / (总计 - 非研发处理) * 100%`

**业务含义**：在规定时间内解决的问题占研发处理问题的比例

**重要说明**：
- 分母是 `总计 - 非研发处理`,即只计算需要研发处理的问题数量
- 如果 `总计 - 非研发处理 = 0`,则显示"不涉及研发处理"

### 3.4 排序

按照 `及时解决率` 从**低到高**排序（便于识别需要改进的产品）

---

## 四、数据处理步骤 3：生成报表

### 4.1 输出文件

**文件路径**：`data/第52周一线问题跟踪确认-20260104.xlsx`

### 4.2 Sheet结构

| Sheet名称 | 数据来源 | 说明 |
|-----------|---------|------|
| `2025122911704000480` | 表格2全部数据 | 原始数据备份 |
| `计算解决率过程数据（调整后）` | 表格1（步骤1处理后的数据） | 包含清洗标记和计算列 |
| `计算解决率` | 步骤2的透视表结果 | 各产品的解决率统计 |

---

## 五、数据字典

### 5.1 关键列说明

| 列名 | 列字母 | 数据类型 | 说明 | 唯一值示例 |
|------|--------|---------|------|-----------|
| 处理方式 | Q列 (17) | 文本 | 标识问题的处理方式 | 研发处理、非研发处理、硬件故障处理 |
| 期望解决时间 | O列 (15) | 日期 | 客户期望的解决时间 | 2026-01-04 |
| 计划完成时间 | W列 (23) | 日期 | 内部计划的完成时间 | 2026-01-06 或空 |
| 研发解决时间 | AD列 (30) | 日期 | 实际研发解决时间 | 日期或空 |
| 审批状态 | AL列 (38) | 文本 | 审批流程状态 | 审批中、已结束、终止、NEW |
| 审批结果 | AK列 (37) | 文本 | 审批结果 | --、审批通过、审批未通过 |
| 更新时间 | AM列 (39) | 日期时间 | 最后更新时间 | 2026-01-04 09:40:48 |
| 所涉产品 | G列 (7) | 文本 | 涉及的产品名称 | 应用安全访问控制系统、数据库水印等 |
| 非研发处理问题类别 | S列 (19) | 文本 | 非研发处理的问题分类 | 非问题（操作、环境等）、其他、需求等 |
| 是否剔除 | AQ列 (43) | 文本 | 数据筛选标记 | YES、NO |

### 5.2 计算列说明

| 列名 | 列字母 | 数据类型 | 计算步骤 | 取值范围 |
|------|--------|---------|---------|---------|
| 研发交付日期偏差 | AE列 (31) | 整数/文本 | 步骤2.2 | 整数（天数）、"非研发处理" |
| 用于交付日期偏差统计 | AO列 (41) | 文本 | 步骤2.3 | 及时解决、未及时解决、超时未解决、处理中暂未超时 |
| 用于交付日期偏差统计DATA | 最后一列 | 文本 | 步骤2.4 | 及时解决、未及时解决、超时未解决、处理中暂未超时 |

**说明**：`用于交付日期偏差统计DATA` 列是 `用于交付日期偏差统计` 列的完整副本，专为外部程序调用设计。

---

## 六、注意事项

1. **日期格式**：所有日期列使用 `YYYY-MM-DD` 或 `YYYY-MM-DD HH:MM:SS` 格式
2. **空值处理**：空值判断使用 `ISBLANK()` 或 `=""` 检查
3. **数据量**：791行，建议使用分批处理或优化性能
4. **文件名**：实际文件名为 [data/计算.xlsx](data/计算.xlsx) 和 [data/原始.xlsx](data/原始.xlsx)，非文档中提到的"计算结果.xlsx"和"原始数据.xlsx"
5. **百分比格式**：保留两位小数，如 "85.67%"
6. **整数计算**：天数偏差使用 `INT()` 函数取整